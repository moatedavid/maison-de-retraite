<?phpclass jvfrm_spot_category_slider1{	public $loaded		= false;	public $attr			= Array();	private $sID			= false;	public function __construct(){		add_action( 'vc_before_init', Array( $this, 'register_shortcode_with_vc' ), 11 );		// Shortcode Resgistered		add_filter( 'jvfrm_spot_other_shortcode_array', Array( $this, 'register_shortcode' ) );		// Shortcode Enqueues & Scripts		add_action( 'wp_footer', Array( $this, 'scripts' ) );	}	public function register_shortcode( $shortcode )	{		return wp_parse_args(			Array(				'jvfrm_spot_category_slider1' => Array( $this, 'config' )			)			, $shortcode		);	}	public function register_shortcode_with_vc()	{		$strGroupFilter					= esc_html__( "Filter", 'javospot' );		$strGroupAdvanced			= esc_html__( "Advanced", 'javospot' );		$strGroupStyle					= esc_html__( "Style", 'javospot' );		if( !function_exists( 'vc_map' ) )			return;		/*vc_map(			Array(				'base'						=> 'jvfrm_spot_category_slider1'				, 'name'						=> esc_html__( "Category Slider 1", 'javospot')				, 'icon'						=> 'jv-vc-shortcode-icon shortcode-slide1'				, 'category'				=> esc_html__('Javo', 'javospot')				, 'params'					=> Array(				 //@group : general					 Array(						'type'					=> 'textfield'						, 'heading'			=> esc_html__( "Title", 'javospot' )						, 'holder'			=> 'div'						, 'class'				=> ''						, 'param_name'	=> 'title'						, 'value'				=> ''					),					Array(						'type'					=> 'dropdown'						, 'heading'			=> esc_html__('Landing map ( Result page)', 'javospot')						, 'holder'			=> 'div'						, 'class'				=> ''						, 'param_name'	=> 'query_requester'						, 'value'				=> apply_filters(							'jvfrm_spot_get_map_templates'							, Array( esc_html__("Default Search Page", 'javospot') => '' )						)					),				 // @group : filter					Array(						'type'					=> 'dropdown'						, 'heading'			=> esc_html__( "Display Category Type", 'javospot')						, 'holder'			=> 'div'						, 'group'				=> $strGroupFilter						, 'class'				=> ''						, 'param_name'	=> 'display_type'						, 'value'				=> Array(							esc_html__('Parent Only', 'javospot')		=> 'parent'							, esc_html__('Parent + Child', 'javospot')	=> 'child'						)					),					Array(						'type'					=>'checkbox'						, 'heading'			=> esc_html__( "Parents", 'javospot')						, 'holder'			=> 'div'						, 'group'				=> $strGroupFilter						, 'class'				=> ''						, 'param_name'	=> 'have_terms'						, 'description'		=> esc_html__('Default : All Parents', 'javospot')						, 'value'				=> $this->get_term_ids( 'listing_category' )					),					Array(						'type'					=> 'checkbox'						, 'heading'			=> esc_html__('Random Ordering', 'javospot')						, 'holder'			=> 'div'						, 'group'				=> $strGroupFilter						, 'class'				=> ''						, 'param_name'	=> 'rand_order'						, 'value'				=> Array(esc_html__('Enabled', 'javospot') =>'use')					),				 //@group : Style					 Array(						'type'					=> 'textfield'						, 'heading'			=> esc_html__('Radius', 'javospot')						, 'holder'			=> 'div'						, 'group'				=> $strGroupStyle						, 'class'				=> ''						, 'param_name'	=> 'radius'						, 'description'		=> esc_html__('Category image radius', 'javospot')						, 'value'				=> intVal( 0 )					),					Array(						'type'					=>'colorpicker'						, 'heading'			=> esc_html__('Category Name Color', 'javospot')						, 'holder'			=> 'div'						, 'group'				=> $strGroupStyle						, 'param_name'	=> 'inline_cat_text_color'						, 'value'				=> ''					),					Array(						'type'					=>'colorpicker'						, 'heading'			=> esc_html__('Name Hover Color', 'javospot')						, 'holder'			=> 'div'						, 'group'				=> $strGroupStyle						, 'param_name'	=> 'inline_cat_text_hover_color'						, 'value'				=> ''					),					Array(						'type'					=>'colorpicker'						, 'heading'			=> esc_html__('Arrow Color', 'javospot')						, 'holder'			=> 'div'						, 'group'				=> $strGroupStyle						, 'param_name'	=> 'inline_cat_arrow_color'						, 'value'				=> ''					),				 // @group : Advanced					Array(						'type'					=> 'textfield'						, 'heading'			=> esc_html__('Display amount of items.', 'javospot')						, 'holder'			=> 'div'						, 'group'				=> $strGroupAdvanced						, 'class'				=> ''						, 'param_name'	=> 'max_amount'						, 'description'		=> esc_html__('(Only Number. recomend around 8)', 'javospot')						, 'value'				=> intVal( 0 )					)				)			)		);*/	}	public function config( $request_attr, $content="")	{		$this->attr = shortcode_atts(			Array(				'title'										=> false,				'query_requester'					=> '',				'display_type'							=> 'parent',				'have_terms'							=> '',				'max_amount'						=> 8,				'rand_order'							=> null,				'radius'									=> 50,				'inline_cat_text_color'				=> '',				'inline_cat_text_hover_color'	=> '',				'inline_cat_arrow_color'			=> '',			), $request_attr		);		$this->loaded	= true;		$this->sID		= 'jvfrm_spot_scd' . md5( wp_rand( 0 , 500 ) .time() );		return $this->output( $this->attr );	}	public static function getHeader( $param ) {		if( empty( $param[ 'title' ] ) )			return;		$strHeader	= $param[ 'title' ];		?>		<div class="row jv-search1-header-row">			<div class="col-xs-12">				<div class="static-label admin-color-setting">					<?php echo $strHeader; ?>				</div>			</div>		</div>		<?php	}	public function get_term_ids( $taxonomy ){		$jvfrm_spot_this_return		= Array();		$jvfrm_spot_this_terms		= get_terms( $taxonomy, Array('hide_empty'=>false, 'parent'=>0) );		if( !is_wp_error( $jvfrm_spot_this_terms ) && !empty( $jvfrm_spot_this_terms ) ){			foreach( $jvfrm_spot_this_terms as $term ) {				$jvfrm_spot_this_return[$term->name]		= $term->term_id;			};		};		return $jvfrm_spot_this_return;	}	public function output( $attr )	{		global $jvfrm_spot_filter_prices, $jvfrm_spot_tso;		$strRequester	= apply_filters( 'jvfrm_spot_wpml_link', intVal( $attr[ 'query_requester' ] ) );		if( !class_exists( 'Lava_Directory_Manager' ) )			return sprintf(				'<p align="center">%s</p>',				esc_html__( "Please, active to the 'Lava Directory manager' plugin", 'javospot' )			);		ob_start();?>		<div class="javo-shortcode shortcode-jvfrm_spot_category_slider1 active" id="<?php echo sanitize_html_class( $this->sID ); ?>">			<?php self::getHeader( $attr ); ?>			<?php			$have_terms = @explode(',', $attr[ 'have_terms' ] );			$jvfrm_spot_have_terms = Array();			if( !empty($have_terms) ){				foreach( $have_terms as $term){					if( (int)$term <= 0 ){						continue;					};					$jvfrm_spot_have_terms[] = get_term( $term, 'listing_category' );					// IF NOT ONLY PARENTS					if( $attr[ 'display_type' ] != 'parent' )					{						$jvfrm_spot_sub_cat = get_terms( 'listing_category', Array( 'parent' => $term , 'hide_empty'=> false ) );						foreach( $jvfrm_spot_sub_cat as $cat )						{							$jvfrm_spot_have_terms[] = $cat;						}					}				};			};			if( $attr[ 'max_amount' ]<=0) $attr[ 'max_amount' ]=8;			if( $attr[ 'radius' ] >50 || $attr[ 'radius' ]<0) $attr[ 'radius' ]=50;			$jvfrm_spot_this_get_term_args				= Array();			$jvfrm_spot_this_get_term_args['hide_empty']	= false;			if( $attr[ 'display_type' ] == 'parent' || $attr[ 'display_type' ] == '' )			{				$jvfrm_spot_this_get_term_args['parent']	= 0;			}			$jvfrm_spot_inline_category_terms = !empty( $jvfrm_spot_have_terms )? $jvfrm_spot_have_terms : get_terms("listing_category", $jvfrm_spot_this_get_term_args);			$jvfrm_spot_get_terms_ids = Array();			if($attr[ 'rand_order' ] != null) shuffle($jvfrm_spot_inline_category_terms); //random ordering			ob_start();?>			<?php if($attr[ 'inline_cat_text_hover_color' ] !=''){				?>				<style>				#javo-inline-category-slider-wrap .javo-inline-category:hover .javo-inline-cat-title{color:<?php echo $attr[ 'inline_cat_text_hover_color' ]; ?> !important;}				</style>				<?php			}			?>			<!-- Slider Shortcode Wrap -->			<div id="javo-inline-category-slider-wrap">				<div id="javo-inline-category-slider-inner">					<div id="javo-inline-category-slider" class="owl-carousel owl-theme" style="display:block;">						<?php						if( !empty( $jvfrm_spot_inline_category_terms ) )						{							foreach( $jvfrm_spot_inline_category_terms as $terms )							{								$featured = get_option( 'lava_listing_category_'.$terms->term_id.'_featured', '' );								$featured = wp_get_attachment_image_src( $featured , 'jvfrm-spot-avatar');								$featured = $featured[0];								$featured = $featured != ''? $featured : $jvfrm_spot_tso->get('no_image', JVFRM_SPOT_IMG_DIR.'/no-image.png');								?>								<div class="item javo-inline-category">									<a href="<?php echo esc_url( add_query_arg( Array( 'category' => $terms->term_id ), $strRequester ) ); ?>">										<img src="<?php echo $featured; ?>"style="width:111px; height:111px; border-radius:<?php echo $attr[ 'radius'];?>%;">										<div class="javo-inline-cat-title" style="	<?php if($attr[ 'inline_cat_text_color' ] !='') echo 'color:'.$attr [' inline_cat_text_color' ] . ';' ?>">											<?php echo $terms->name; ?>										</div>									</a>								</div>							<?php							}						} ?>					</div>					<div class="customNavigation">					  <a class="btn prev" <?php if($attr[ 'inline_cat_arrow_color' ] !='') echo 'style="color:'.$attr[ 'inline_cat_arrow_color' ].';"'?>><i class="fa fa-angle-left"></i></a>					  <a class="btn next" <?php if($attr[ 'inline_cat_arrow_color' ] !='') echo 'style="color:'.$attr[ 'inline_cat_arrow_color' ].';"'?>><i class="fa fa-angle-right"></i></a>					</div><!--javo-inline-category-slider-->				</div><!--javo-inline-category-slider-inner-->			</div><!--javo-inline-category-slider-wrap-->		</div><!-- /.shortcode-jvfrm_spot_category_slider1 -->	<?php		$arrOutput		= Array();		$arrOutput[]	= "<script type=\"text/javascript\">";		$arrOutput[]	= "jQuery( function($){ $.jvfrm_spot_search_shortcode( '#{$this->sID}' ); });";		$arrOutput[]	= "</script>";		echo join( '', $arrOutput );		return ob_get_clean();	}	public function scripts()	{		if( !$this->loaded )			return;		$attr				= $this->attr;		wp_enqueue_script( 'owl-carousel-script' );		?>		<script type="text/javascript">			jQuery( function( $ ) {				var el			= $( "#javo-inline-category-slider-wrap" );				var el_slider	= el.find( "#javo-inline-category-slider" );				el_slider.owlCarousel({					items				: parseInt(<?php echo $attr[ 'max_amount' ]; ?>), //10 items above 1000px browser width					itemsDesktop		: [1000,5], //5 items between 1000px and 901px					itemsDesktopSmall	: [900,3], // 3 items betweem 900px and 601px					itemsTablet			: [600,2], //2 items between 600 and 0;					itemsMobile			: false // itemsMobile disabled - inherit from itemsTablet option				});				$( el )					.on( 'click', '.next', function(){ el_slider.trigger( 'owl.next' ); } )					.on( 'click', '.prev', function(){ el_slider.trigger( 'owl.prev' ); } )					.on( 'click', '.play', function(){ el_slider.trigger( 'owl.play', 1000 ); } )					.on( 'click', '.stop', function(){ el_slider.trigger( 'owl.stop' ); } )			} );		</script>		<?php	}}if( !function_exists( 'jvfrm_spot_category_slider1_init') ){	function jvfrm_spot_category_slider1_init() {		$GLOBALS[ 'jvfrm_spot_category_slider1' ] = new jvfrm_spot_category_slider1;	}	add_action( 'after_setup_theme', 'jvfrm_spot_category_slider1_init' );}